<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <meta http-equiv='Content-Type' content='application/xhtml+xml; charset=UTF-8'/>
    <title>Chili Gruppen</title>
    <h:outputStylesheet library="css" name="style.css"/>
    <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces" />
</h:head>
<h:body>
    <!-- Meny -->
    <h:form id="menu">
        <p:menubar>
            <p:menuitem icon="pi pi-home"/>

            <p:submenu value="Kategorier" label="Kategorier">
                <p:menuitem value="Röd chili"/>
                <p:menuitem value="Grön chili"/>
                <p:menuitem value="Rosa chili"/>
            </p:submenu>

            <p:menuitem value="Kontakta"/>
            <p:menuitem icon="pi pi-shopping-cart" onclick="PF('cartDialog').show()"/>
            <f:facet name="options">
                <p:inputText style="margin: 1px 10px 1px 1px"
                             placeholder="Sök"
                             value="#{productController.searchBox}"
                             update=""
                >
                    <p:ajax event="keyup" update="productGrid" listener="#{productController.searchProduct(productController.searchBox)}"/>
                </p:inputText>
                <p:commandButton  value="Logga in" onclick="PF('loginDialog').show()"/> <!-- action="loggain.xhtml" -->
                <p:commandButton action="register.xhtml" value="Registrera"/>
            </f:facet>

        </p:menubar>
    </h:form>


    <!-- Lägger in produkter i grid (dynamisk) och visar de på sidan -->
    <p:dataGrid id="productGrid" var="product" value="#{productController.productList}" columns="3" styleClass="gridStyle" layout="grid"
                paginator="true" paginatorPosition="bottom" paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
    rowsPerPageTemplate="9" rows="9">
        <p:panel id="panel" header="#{product.name}" style="text-align:center">
            <p:commandLink  oncomplete="PF('popup').show()" action="#{productController.modal(product)}" update="dialogId">
                <h:panelGrid id="productPanel" columns="1" styleClass="productDesign">
                    <p:graphicImage library="images" name="#{product.image_url}" styleClass="productImage" />
                    <p:outputLabel value="Scoville: #{product.scoville_strength}"/>
                    <p:outputLabel value="#{product.price}kr"/>
                </h:panelGrid>
            </p:commandLink>
        </p:panel>
    </p:dataGrid>



    <!--  Popup dialog när man klickar på en product  -->
    <p:dialog id="dialogId" header="#{productController.currentProduct.name}" widgetVar="popup" showEffect="fade"
              hideEffect="fade" closeOnEscape="true" >
        <h:form>
        <p:panelGrid columns="1" styleClass="panelGrid">
            <h:graphicImage library="images" name="#{productController.currentProduct.image_url}"/>
            <h:outputText id="testId" value="#{productController.currentProduct.description}"/>
            <br/>
            <h:outputText value="#{productController.currentProduct.price}" suffix=" kr"/>
            <br/>
            <p:panelGrid columns="2">
                <p:commandButton value="Köp" action="#{productController.addToCart(productController.currentProduct.id)}" update="cartId"/>
                <p:spinner  min="1" max="100" value="#{productController.currentProductCount}"  suffix="st"/>
            </p:panelGrid>
        </p:panelGrid>
        </h:form>
    </p:dialog>


    <!-- Popup modal för inloggningsrutan, FaceMessage i högra hörnet. Login knapp har en oncomplete som kallar på en JS funktion.-->
    <p:dialog id="loginId" header="Login" widgetVar="loginDialog" showEffect="fade"
              hideEffect="fade" modal="true" closable="true" appendToBody="true" closeOnEscape="true">
        <h:form>
            <p:growl id="growl" showDetail="true" life="2000"/>
            <h:panelGrid columns="2" cellpadding="5">
                <h:outputLabel for="user" value="Användarnamn:"/>
                <p:inputText id="user" value="#{loginController.username}"/>
                <h:outputLabel for="passBox" value="Lösenord:"/>
                <p:password id="passBox" value="#{loginController.password}"/>
            </h:panelGrid>
            <h:panelGrid columns="2" cellpadding="5" styleClass="panelGrid">
                <p:commandButton update="growl" value="Logga in" action="#{loginController.login}"
                                 process="@form" partialSubmit="true" ajax="true" oncomplete="handleLoginRequest(xhr, status, args)"/>
                <p:commandButton value="Skapa konto" action="register"/>
            </h:panelGrid>
        </h:form>
    </p:dialog>

    <!-- Popup dialog för cart -->
    <p:dialog id="cartId" header="Varukorg" widgetVar="cartDialog">
        <p:dataGrid  var="cart" columns="1" value="#{productController.cartList}">
            <h:panelGrid columns="6" styleClass="cartGrid">
                <p:outputLabel prefix="Produkt: " value="#{cart.name}"/>
                <p:outputLabel suffix=" kr" value="#{cart.price}"/>
                <p:outputLabel prefix="scoville: " value="#{cart.scoville_strength}"/>
                <p:outputLabel prefix="antal: " value="#{productController.currentProductCount}"/>
                <p:graphicImage library="images" name="#{cart.image_url}" styleClass="cartImage"/>
                <p:commandButton icon="pi pi-times" action="#{productController.deleteFromCart(cart)}" update="cartId"/>
            </h:panelGrid>
        </p:dataGrid>
        <h:panelGrid columns="2">
        <p:commandButton icon="pi pi-check" value="Beställ"/>
        <p:commandButton value="Töm varukorg" action="#{productController.emptyCart}" update="cartId"/>
    </h:panelGrid>
    </p:dialog>


    <h:outputScript library="js" name="script.js" />
</h:body>
</html>
